{"status": "chatting", "priority": "urgent", "title": "Sometimes /account/settings/location/ crashes", "milestone": "", "superceder": "", "nosylist": ["individuwill, onceuponatimeforever, paulproteus"], "assigned": "individuwill", "waitingon": "", "keywords": [], "id": "919", "files": [], "history": [{"message": "In the issue #990, I've removed all mentions of the location, including the settings/location/ path.\n   \n", "author": "onceuponatimeforever"}, {"message": "Attached is an imperfect, still-in-progress PR: <a href=\"https://github.com/openhatch/oh-mainline/pull/200\">https://github.com/openhatch/oh-mainline/pull/200</a> \nFeel free to comment, I still cannot reproduce the bug. :(\n   \n", "author": "onceuponatimeforever"}, {"message": "No worries about not following up.\n\nReproducing it is likely to be somewhat subtle. I seem to recall you were \nhaving trouble getting the MaxMind database in a path that our code will \nfind.\n\nAlso our code for finding that database is pretty bad. We should simplify \nit.\n\nI won't be on IRC much later tonight, but if you can manage to help there \n&amp; then from others, thumbs up. I'm happy to find some other time.\n   \n", "author": "paulproteus"}, {"message": "I couldn't repro the bug several weeks ago. Sorry I should've kept you updated on the progress of \nthis ticket. I'll look into this further later tonight and Ill be on IRC to discuss it.\n   \n", "author": "onceuponatimeforever"}, {"message": "Hi Susan!\n\nI remember you and I were looking at this on IRC a few weeks ago. Are you still \ninterested in working on it? Did you manage to reproduce the problem in the test \nsuite?\n   \n", "author": "paulproteus"}, {"message": "This is the traceback:\n\nTraceback (most recent call last):\n\n  File \"/home/deploy/milestone-\na.buildout/vendor/packages/Django/django/core/handlers/base.py\", line 111, in \nget_response\n    response = callback(request, *callback_args, **callback_kwargs)\n\n  File \"/home/deploy/milestone-\na.buildout/vendor/packages/Django/django/contrib/auth/decorators.py\", line 23, \nin _wrapped_view\n    return view_func(request, *args, **kwargs)\n\n  File \"&lt;string&gt;\", line 2, in set_location\n\n  File \"/home/deploy/milestone-a.buildout/mysite/base/decorators.py\", line 73, \nin view\n    request, template, view_data = func(*args, **kw)\n\n  File \"/home/deploy/milestone-a.buildout/mysite/account/views.py\", line 290, in \nset_location\n    mysite.base.middleware.get_user_ip(request))[1]\n\n  File \"/home/deploy/milestone-a.buildout/mysite/profile/view_helpers.py\", line \n142, in get_geoip_guess_for_ip\n    country_name = geoip_database.country_name_by_addr(ip_as_string)\n\n  File \"/home/deploy/milestone-\na.buildout/vendor/packages/pygeoip/pygeoip/__init__.py\", line 467, in \ncountry_name_by_addr\n    return self.record_by_addr(addr)['country_name']\n\nTypeError: 'NoneType' object is unsubscriptable\n\n\nIn my opinion, the view_helpers.py get_geoip_guess_for_ip() function should \ncatch TypeError and do something reasonable in that situation.\n\nThis causes real users to hit our Error 500 page, which is sad.\n   \n", "author": "paulproteus"}]}